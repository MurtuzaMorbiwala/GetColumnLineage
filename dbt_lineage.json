{
  "customers": {
    "columns": {
      "CUSTOMER_ID": {
        "type": "NUMBER",
        "description": ""
      },
      "FIRST_NAME": {
        "type": "TEXT",
        "description": ""
      },
      "LAST_NAME": {
        "type": "TEXT",
        "description": ""
      },
      "FIRST_ORDER_DATE": {
        "type": "DATE",
        "description": ""
      },
      "MOST_RECENT_ORDER_DATE": {
        "type": "DATE",
        "description": ""
      },
      "NUMBER_OF_ORDERS": {
        "type": "NUMBER",
        "description": ""
      }
    },
    "upstream_models": {
      "stg_customers": [
        "CUSTOMER_ID",
        "FIRST_NAME",
        "LAST_NAME"
      ],
      "stg_orders": [
        "ORDER_ID",
        "CUSTOMER_ID",
        "ORDER_DATE",
        "STATUS"
      ]
    },
    "sql": "with customers as (\r\n\r\n    select * from {{ ref('stg_customers') }}\r\n\r\n),\r\n\r\norders as (\r\n\r\n    select * from {{ ref('stg_orders') }}\r\n\r\n),\r\n\r\ncustomer_orders as (\r\n\r\n    select\r\n        customer_id,\r\n\r\n        min(order_date) as first_order_date,\r\n        max(order_date) as most_recent_order_date,\r\n        count(order_id) as number_of_orders\r\n\r\n    from orders\r\n\r\n    group by 1\r\n\r\n),\r\n\r\nfinal as (\r\n\r\n    select\r\n        customers.customer_id,\r\n        customers.first_name,\r\n        customers.last_name,\r\n        customer_orders.first_order_date,\r\n        customer_orders.most_recent_order_date,\r\n        coalesce(customer_orders.number_of_orders, 0) as number_of_orders\r\n\r\n    from customers\r\n\r\n    left join customer_orders using (customer_id)\r\n\r\n)\r\n\r\nselect * from final"
  },
  "stg_orders": {
    "columns": {
      "ORDER_ID": {
        "type": "NUMBER",
        "description": ""
      },
      "CUSTOMER_ID": {
        "type": "NUMBER",
        "description": ""
      },
      "ORDER_DATE": {
        "type": "DATE",
        "description": ""
      },
      "STATUS": {
        "type": "TEXT",
        "description": ""
      }
    },
    "upstream_models": {},
    "sql": "select\r\n    id as order_id,\r\n    user_id as customer_id,\r\n    order_date,\r\n    status\r\n\r\nfrom {{ source('jaffle_shop', 'orders') }}"
  },
  "stg_customers": {
    "columns": {
      "CUSTOMER_ID": {
        "type": "NUMBER",
        "description": ""
      },
      "FIRST_NAME": {
        "type": "TEXT",
        "description": ""
      },
      "LAST_NAME": {
        "type": "TEXT",
        "description": ""
      }
    },
    "upstream_models": {},
    "sql": "select\r\n    id as customer_id,\r\n    first_name,\r\n    last_name\r\n\r\nfrom {{ source('jaffle_shop', 'customers') }}"
  },
  "example": {
    "columns": {
      "ID": {
        "type": "NUMBER",
        "description": ""
      },
      "FIRST_NAME": {
        "type": "TEXT",
        "description": ""
      },
      "LAST_NAME": {
        "type": "TEXT",
        "description": ""
      }
    },
    "upstream_models": {},
    "sql": "Select * \r\nfrom {{ source('jaffle_shop', 'customers') }}"
  }
}